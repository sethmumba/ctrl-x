{% extends "base.html" %}
{% block title %}Order #{{ order.id }}{% endblock %}

{% block content %}

<div class="order-page-wrapper">

    <!-- Header Card -->
    <div class="order-header-card">
        <h2 class="order-title">Order #{{ order.id }} â€” {{ order.store_name }}</h2>
        <p class="order-status">Current Status: <span class="status-accent">{{ human_status }}</span></p>
    </div>

    <!-- Progress Timeline Card -->
    <div class="timeline-card card">
        <h3 class="timeline-title">Store Build Progress</h3>
        <div class="timeline">
            <!-- PROGRESS_STEPS and order_progress_index must be provided by Django context -->
            {% for step_key, step_label in PROGRESS_STEPS %}
            <div class="timeline-step {% if forloop.counter0 <= order_progress_index %}active{% endif %}">
                <span class="step-circle">{{ forloop.counter }}</span>
                <p class="step-label">{{ step_label }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Details Section (Two Columns) -->
    <div class="details-section">

        <!-- Left Column: Specifications -->
        <div class="details-card specifications-card">
            <h3 class="card-title">Order Specifications</h3>
            <ul class="specifications-list">
                <li><span class="spec-label">Niche:</span> <span class="spec-value">{{ order.get_niche_display }}</span></li>
                <li><span class="spec-label">Supplier,:</span> <span class="spec-value">{{ order.get_supplier_display }}</span></li>
                <li><span class="spec-label">Theme:</span> <span class="spec-value">{{ order.get_theme_display }}</span></li>
                <li><span class="spec-label">Profit Margin:</span> <span class="spec-value">{{ order.desired_profit_margin }}%</span></li>
                <li><span class="spec-label">Markets:</span> <span class="spec-value">{{ order.markets|join:", " }}</span></li>
                <li><span class="spec-label">Color Palette:</span> <span class="spec-value">{{ order.color_palette }}</span></li>
            </ul>

            {% if order.logo %}
            <div class="order-logo">
                <p class="logo-label">Submitted Logo:</p>
                <img src="{{ order.logo.url }}" alt="Client Logo" class="logo-image">
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Build Status & Handover -->
        <div class="details-card status-card">
            <h3 class="card-title">Build Status & Handover</h3>

            {% if order.assigned_staff %}
            <div class="assigned-builder">
                <p class="builder-label">Assigned Builder:</p>
                <div class="builder-info">
                    <div class="builder-avatar"></div>
                    <span class="builder-name">{{ order.assigned_staff.username }}</span>
                </div>
            </div>
            {% endif %}

            {% if order.progress == 'completed' %}
            <div class="completion-notification">
                <h3 class="completion-title">ðŸŽ‰ Your Store is Ready!</h3>
                <p class="completion-text">Please check your email for instructions to take ownership of your Shopify store.</p>
                <a href="{{ order.store_link }}" class="btn btn-accent">View Store Link</a>
            </div>
            {% endif %}
            
             <div class="notes-section">
                <h4 class="notes-title">Notes from Builder</h4>
                <p class="notes-content">{{ order.latest_notes|default:"No updates available at this time." }}</p>
            </div>
        </div>

    </div>

</div>

{% endblock %}